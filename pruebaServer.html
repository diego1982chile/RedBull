<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>  
<link href="css/jquery-ui-1.10.2.custom.min.css" rel="stylesheet" />
<link href="css/jquery.mobile-1.3.1.min.css" rel="stylesheet" />

<style>
	
	table tr td{
		text-align: center;
		font-family: "Arial",Georgia,Serif;		
	}	
	h4,h5,div,table{
		padding:0em;
		margin:0em;
	}
	.seleccionada{
		background:blue;
		color:white;
	}
	
</style>

<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>

<script type="text/javascript" src="js/taffy.js"></script>
<script type="text/javascript" src="js/json2.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.10.2.custom.min.js"></script>
<script type="text/javascript" src="js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="js/jquery.dataTables.min.js"></script>

<script>

/**
 * Very simple way to check if a file exists on this domain.
 * Use with the jQuery library.
 *
 * Important: 	Works only on the same domain. 
 * 		Cross-domain-requests have to be done in another way (see JSONP)!
 *
 * Use: console.log(   "/data/list.json".fileExists()  );
 */
String.prototype.fileExists = function() {
	filename = this;
	
	var response = jQuery.ajax({
		url: filename,
		type: 'HEAD',
		async: false
	}).status;	
	
	return (response != "200") ? false : true;
}

	// Indice comienza en 1
	
		var cursor=1;
        var id_respuesta=1;
		var id_toma=1;			
        
        var preguntasDB;
        var seccionesDB;		
        var topicosDB;        
        var categoriasDB;									
        var preguntas_categoriasDB;											
        var itemesDB;								
        var alternativasDB;	    	

		// var pathCuestionario="cuestionario.txt"
		// var pathCuestionario="\\Application\\cuestionario.txt";
		
	function respuesta(id_respuesta,valor_respuesta,id_item,id_pregunta,id_categoria)
	{
            this.id_respuesta=id_respuesta;
            this.valor_respuesta=valor_respuesta;               
            this.id_item=id_item;
            this.id_pregunta=id_pregunta;	
            this.id_categoria=id_categoria;
	}	

	var respuestas= new Array();

	var respuestasDB= TAFFY(respuestas); 			

	// Carga de datos en los contenedores de objetos
	
	function cargar_datos()
	{												
			$.getJSON('php/cargar_cuestionario.php',{caso:1},function(data){										
				topicosDB=TAFFY(JSON.stringify(data));		
				$.getJSON('php/cargar_cuestionario.php',{caso:2},function(data){
					seccionesDB=TAFFY(JSON.stringify(data));
					$.getJSON('php/cargar_cuestionario.php',{caso:3},function(data){
						categoriasDB=TAFFY(JSON.stringify(data));
						$.getJSON('php/cargar_cuestionario.php',{caso:4},function(data){					
							preguntasDB=TAFFY(JSON.stringify(data));								
							$.getJSON('php/cargar_cuestionario.php',{caso:5},function(data){
								preguntas_categoriasDB=TAFFY(JSON.stringify(data));
								$.getJSON('php/cargar_cuestionario.php',{caso:6},function(data){
									itemesDB=TAFFY(JSON.stringify(data));
									$.getJSON('php/cargar_cuestionario.php',{caso:7},function(data){
										alternativasDB=TAFFY(JSON.stringify(data));									
										// cargar_contenido(cursor);									
									});									
								});	
							});		
						});	
					});	
				});				
			});																	      		
	}	
	
	// Carga el contenido desde objetos 'consultables' a partir de los contenedores
	
    function cargar_contenido(id_pregunta)
    {					     					
		// alert('voy a cargar el contenido');
        // Filtrar preguntas por id_pregunta segun cursor actual		
        preguntasDB().filter({'id_pregunta':id_pregunta}).each(function (r1) { 

            seccionesDB().filter({'id_seccion':r1.id_seccion}).each(function (r2) { 

                topicosDB().filter({'id_topico':r2.id_topico}).each(function (r3) { 
				
					// alert('id_topico='+r3.id_topico+' id_seccion'+r2.id_seccion);				
					$('#head_topico'+r3.id_topico).html("<h5 style='color:"+r3.color_letra+"'>"+r3.numero_topico+'. '+r3.nombre_topico+"<h5>");
					$('#head_topico'+r3.id_topico).css('background-color',r3.color_topico);
					
					$('#seccion'+r3.id_topico+r2.id_seccion+' thead tr th').html("<h5>"+r3.numero_topico+"."+r2.numero_seccion+" "+r2.nombre_seccion+"</h5>");
                    $('#seccion'+r3.id_topico+r2.id_seccion+' thead tr th').css('background-color',r2.color_seccion);										                

					$('#seccion'+r3.id_topico+r2.id_seccion).dataTable().fnAddData(["<h5 style='padding:0em'>"+r3.numero_topico+'.'+r2.numero_seccion+'.'+r1.numero_pregunta+' '+r1.contenido_pregunta+"</h5>"]);					
					
                    switch(parseInt(r1.tipo))
                    {
                        case 1:// Tipo alternativa => cargar las alternativas para esta pregunta
                            // Verificar si existen categorias para esta pregunta	                                                       
							
							var tiene_categoria=false;
                            
							preguntas_categoriasDB().filter({'id_pregunta':id_pregunta}).each(function () {
                                tiene_categoria=true;
                                return false;
                            });
																					
							switch(parseInt(r1.tipo2))
							{								
								case 1: // Tipo disyuntiva
									if(tiene_categoria)
									{                      
										var maxCat;
																													
										if(id_pregunta>33)
										{
											respuestasDB().filter({'id_pregunta':33}).each(function(r20){												
												maxCat=parseInt(r20.valor_respuesta);												
											});
										}
										else
										{
											maxCat=15;
										}										
									
										var html="<table id='tabla_alternativas"+cursor+"' width='100%' border='1' align='left'>";

										var contCat=0;
										
										var flag=false;
										
										preguntas_categoriasDB().filter({'id_pregunta':id_pregunta}).each(function (r5) {	
														
											if(flag)
												return false;
											
											categoriasDB().filter({'id_categoria':r5.id_categoria}).each(function (r6) {
																				
											var cont=0;
											
											alternativasDB().filter({'id_categoria':r5.id_categoria},{'id_pregunta':id_pregunta}).each(function (r9){
												cont++;
											});											
											html=html+"<tr><td width='25%' style='text-align:left' rowspan='"+cont+"'>"+r6.nombre_categoria+"</td>";											
											var cont=1;

											alternativasDB().filter({'id_categoria':r5.id_categoria},{'id_pregunta':id_pregunta}).each(function (r7) {

											itemesDB().filter({'id_item':r7.id_item}).each(function (r8) {

												if(cont===1)
													html=html+"<td width='75%' style='text-align:left'><input type='radio' id='radio"+cont+"' pregunta='"+cursor+"' categoria='"+r5.id_categoria+"' item='"+r7.id_item+"' name='radio"+cursor+r5.id_categoria+"' /><label style='font-size:0.9em'>"+r8.nombre_item+"</label></td></tr>";                                                                                                
												else                                                                                                
													html=html+"<tr id='"+r8.id_item+"'><td item='"+r7.id_item+"' style='text-align:left'><input type='radio' id='radio"+cont+"' pregunta='"+cursor+"' categoria='"+r5.id_categoria+"' item='"+r7.id_item+"' name='radio"+cursor+r5.id_categoria+"' value='"+r5.id_categoria+r8.id_item+"' /><label style='font-size:0.9em'>"+r8.nombre_item+"</label></td></tr>";										
											});	
											cont++;
											});	
											contCat++;
											
											if(contCat>=maxCat)																						
												flag=true;																						
										});			
									});	
									html=html+"</table>";                         
									}
									else
									{
										// Si no existen categorias para esta pregunta, cargar directamente las alternativas
										var html="<table id='tabla_alternativas"+cursor+"' width='100%' border='1' align='left'>";
										var cont=1;
										alternativasDB().filter({'id_pregunta':id_pregunta}).each(function (r5) {					
												cont++;
												itemesDB().filter({'id_item':r5.id_item}).each(function (r6) {									
														html=html+"<tr><td id='"+r6.id_item+"' style='text-align:left'><input type='radio' id='radio"+cont+"' pregunta='"+cursor+"' categoria='"+r5.id_categoria+"' item='"+r5.id_item+"' name='radio"+cursor+r5.id_categoria+"' value='"+r6.id_item+"' /><label style='font-size:0.9em'>"+r6.nombre_item+"</label></td></tr>";										
												});															
										});		
										html=html+"</table>";									
									}					
									
									// $('#respuesta').css('height',"'"+430-parseInt($('#pregunta').css('height'))+"px'"); 
									$('#seccion'+r3.id_topico+r2.id_seccion).dataTable().fnAddData([html]);
									// $('#respuesta').html(html);   															
									
									// Si existen respuestas buscar las respuestas correspondiente a la pregunta actual y cargarlas
																		
									respuestasDB().filter({'id_pregunta':id_pregunta}).each(function (r10) {											
										$('[name=radio'+r10.id_categoria+']').filter('[categoria="'+r10.id_categoria+'"][item="'+r10.id_item+'"]').prop('checked', true);
										$('[name=radio'+r10.id_categoria+']').filter('[categoria="'+r10.id_categoria+'"][item="'+r10.id_item+'"]').parent().addClass("seleccionada");
									});
									
									$('#tabla_alternativas'+cursor+' tr td').click(function(){
										$('[name=radio'+$(this).children().attr('pregunta')+$(this).children().attr('categoria')+']').parent('.seleccionada').removeClass();
										$(this).addClass("seleccionada");                                
										$('[name=radio'+$(this).children().attr('pregunta')+$(this).children().attr('categoria')+']').filter('[pregunta='+$(this).children().attr('pregunta')+'][categoria="'+$(this).children().attr('categoria')+'"][item="'+$(this).children().attr('item')+'"]').prop('checked', true);                                
										guardarRespuesta(id_pregunta,$(this).children().attr('categoria'),$(this).children().attr('item'),null); 																																						
									});													
									break;
								case 2: // Tipo conjuntiva
									if(tiene_categoria)
									{                         										
										var html="<table id='tabla_alternativas"+cursor+"' width='100%' border='1' align='left'>";

										preguntas_categoriasDB().filter({'id_pregunta':id_pregunta}).each(function (r5) {

											categoriasDB().filter({'id_categoria':r5.id_categoria}).each(function (r6) {
																				
											var cont=0;
											
											alternativasDB().filter({'id_categoria':r5.id_categoria},{'id_pregunta':id_pregunta}).each(function (r9){
												cont++;
											});											
											html=html+"<tr><td width='30%' style='text-align:left' rowspan='"+cont+"'>"+r6.nombre_categoria+"</td>";											
											var cont=1;

											alternativasDB().filter({'id_categoria':r5.id_categoria},{'id_pregunta':id_pregunta}).each(function (r7) {

											itemesDB().filter({'id_item':r7.id_item}).each(function (r8) {

												if(cont===1)
													html=html+"<td width='70%' style='text-align:left'><input type='checkbox' id='radio"+cont+"' pregunta='"+cursor+"' categoria='"+r5.id_categoria+"' item='"+r7.id_item+"' name='checkbox' /><label style='font-size:0.9em'>"+r8.nombre_item+"</label></td></tr>";                                                                                                
												else                                                                                                
													html=html+"<tr width='50%' id='"+r8.id_item+"'><td item='"+r7.id_item+"' style='text-align:left'><input type='checkbox' id='radio"+cont+"' pregunta='"+cursor+"' categoria='"+r5.id_categoria+"' item='"+r7.id_item+"' name='checkbox' value='"+r5.id_categoria+r8.id_item+"' /><label style='font-size:0.9em'>"+r8.nombre_item+"</label></td></tr>";										
											});	
											cont++;
											});										
										});			
									});	
									html=html+"</table>";                         
									}
									else
									{
										// Si no existen categorias para esta pregunta, cargar directamente las alternativas
										var html="<table id='tabla_alternativas"+cursor+"' width='100%' border='1' align='left'>";
										var cont=1;
										alternativasDB().filter({'id_pregunta':id_pregunta}).each(function (r5) {					
												cont++;
												itemesDB().filter({'id_item':r5.id_item}).each(function (r6) {									
														html=html+"<tr><td id='"+r6.id_item+"' style='text-align:left'><input type='checkbox' id='radio"+cont+"' pregunta='"+cursor+"' categoria='"+r5.id_categoria+"' item='"+r5.id_item+"' name='checkbox' value='"+r6.id_item+"' /><label style='font-size:0.9em'>"+r6.nombre_item+"</label></td></tr>";										
												});															
										});		
										html=html+"</table>";									
									}							
									// $('#respuesta').css('height',"'"+430-parseInt($('#pregunta').css('height'))+"px'"); 
									// $('#respuesta').html(html);   															
									$('#seccion'+r3.id_topico+r2.id_seccion).dataTable().fnAddData([html]);
									// Si existen respuestas buscar las respuestas correspondientes a la pregunta actual y cargarlas
																		
									respuestasDB().filter({'id_pregunta':id_pregunta}).each(function (r10) {							
										$('[name=checkbox]').filter('[categoria="'+r10.id_categoria+'"][item="'+r10.id_item+'"]').prop('checked', true);
										$('[name=checkbox]').filter('[categoria="'+r10.id_categoria+'"][item="'+r10.id_item+'"]').parent().addClass("seleccionada");
									});
									
									$('#tabla_alternativas'+cursor+' tr td').click(function(){	
										// alert($(this).children().attr('pregunta'));
										if($(this).children().prop('checked'))
										{
											$(this).removeClass("seleccionada");
											$('[name=checkbox]').filter('[pregunta='+$(this).children().attr('pregunta')+'][categoria="'+$(this).children().attr('categoria')+'"][item="'+$(this).children().attr('item')+'"]').prop('checked', false);											
										}
										else
										{
											$(this).addClass("seleccionada");        											
											$('[name=checkbox]').filter('[pregunta='+$(this).children().attr('pregunta')+'][categoria="'+$(this).children().attr('categoria')+'"][item="'+$(this).children().attr('item')+'"]').prop('checked', true);
										}										                              
										guardarRespuesta(id_pregunta,$(this).children().attr('categoria'),$(this).children().attr('item'),null); 																											
									});																													
									break;																					                                                     
								case 3: // Tipo conjuntiva con valor	
									var html="";
									
									if(tiene_categoria)
									{                         													
										html=html+"<div><table id='tabla_alternativas"+cursor+"' width='100%' border='1' align='left'></div>";

										preguntas_categoriasDB().filter({'id_pregunta':id_pregunta}).each(function (r5) {

											categoriasDB().filter({'id_categoria':r5.id_categoria}).each(function (r6) {
																				
											var cont=0;
											
											alternativasDB().filter({'id_categoria':r5.id_categoria},{'id_pregunta':id_pregunta}).each(function (r9){
												cont++;
											});											
											html=html+"<tr><td width='20%' style='text-align:left' rowspan='"+cont+"'>"+r6.nombre_categoria+"</td>";											
											var cont=1;

											alternativasDB().filter({'id_categoria':r5.id_categoria},{'id_pregunta':id_pregunta}).each(function (r7) {

											itemesDB().filter({'id_item':r7.id_item}).each(function (r8) {

												if(cont===1)
													html=html+"<td width='50%' style='text-align:left'><label style='font-size:0.9em'>"+r8.nombre_item+"</label></td><td width='20%'><input id='valor"+cont+"' pregunta='"+cursor+"' categoria='"+r5.id_categoria+"' item='"+r7.id_item+"' name='input"+r5.id_categoria+r7.id_item+"' class='valor' /></td></tr>";                                                                                                
												else                                                                                                
													html=html+"<tr width='50%' id='"+r8.id_item+"'><td item='"+r7.id_item+"' style='text-align:left'><label style='font-size:0.9em'>"+r8.nombre_item+"</label></td><td width='20%'><input id='valor"+cont+"' pregunta='"+cursor+"' categoria='"+r5.id_categoria+"' item='"+r7.id_item+"' name='input"+r5.id_categoria+r7.id_item+"' class='valor' /></td></tr>";										
											});	
											cont++;
											});										
										});			
									});	
									html=html+"</table>";                         
									}
									else
									{										
										// Si no existen categorias para esta pregunta, cargar directamente las alternativas
										html=html+"<div><table id='tabla_alternativas"+cursor+"' width='100%' border='1' align='left'></div>";
										var cont=1;
										alternativasDB().filter({'id_pregunta':id_pregunta}).each(function (r5) {					
												cont++;
												itemesDB().filter({'id_item':r5.id_item}).each(function (r6) {									
													html=html+"<tr><td id='"+r6.id_item+"' style='text-align:left' width='50%'><label style='font-size:0.9em'>"+r6.nombre_item+"</label></td><td width='20%'><input id='valor"+cont+"' pregunta='"+cursor+"' categoria='"+r5.id_categoria+"' item='"+r5.id_item+"' name='input"+r5.id_categoria+r5.id_item+"' class='valor' /></td></tr>";										
												});															
										});		
										html=html+"</table>";									
									}															
									// $('#respuesta').html(html); 
									// $('#respuesta').css('height',"'"+430-parseInt($('#pregunta').css('height'))+"px'"); 
									// $('#respuesta').html(html);
									$('#seccion'+r3.id_topico+r2.id_seccion).dataTable().fnAddData([html]);																		
									// Si existen respuestas buscar las respuestas correspondientes a la pregunta actual y cargarlas
																		
									respuestasDB().filter({'id_pregunta':id_pregunta}).each(function (r10) {											
										$('[name=input'+r10.id_categoria+r10.id_item+']').val(r10.valor_respuesta);
									});
																		
									$('.valor').css('width','100%');
									
									var pregunta=$('.valor:first').attr('pregunta');
									var categoria=$('.valor:first').attr('categoria');
									var item=$('.valor:first').attr('item');
									
									$('[pregunta='+pregunta+'][categoria='+categoria+'][item='+item+']').focus();
									
									$('.valor').focusin(function(){
										pregunta=$(this).attr('pregunta');
										categoria=$(this).attr('categoria');
										item=$(this).attr('item');
									});																			
									
									$('.borrar').click(function(){								
										$('[pregunta='+pregunta+'][categoria='+categoria+'][item='+item+']').val(''); 										
									});																																					                           																			
									break;		
							}
                            break;							
                        case 2:// Tipo numerico => cargar un input                                                        
                            var html="<div style='height:50px'><input id='valor' /></div>";
                            // $('#respuesta').html(html);
							$('#seccion'+r3.id_topico+r2.id_seccion).dataTable().fnAddData([html]);
							// $('button').button();
							// $('button').css('padding','0em');
							// $('span').css('padding','0em');
							// Si existen respuestas buscar las respuestas correspondiente a la pregunta actual y cargarlas
																		
							respuestasDB().filter({'id_pregunta':id_pregunta}).each(function (r10) {							
								$('#valor').val(r10.valor_respuesta);								
							});
							
                            // $('#valor').css('font-size','20px');
					
                            break;				
                    }						
                });
            });
        });				
    }
	
    function guardarRespuesta(id_pregunta,id_categoria,id_item,valor)    
    {		
        var existeRespuesta=false;
        var tipoPregunta;		       
		
		preguntasDB().filter({'id_pregunta':id_pregunta}).each(function (r0) {
            tipoPregunta=r0.tipo2;
            return false;
        });		
		
		switch(parseInt(tipoPregunta))
		{
			case 1: // TIPO DISYUNTIVA -> Buscar si existe la misma: pregunta y categoria			
				respuestasDB().filter({'id_pregunta':id_pregunta,'id_categoria':id_categoria}).each(function () {
					existeRespuesta=true;
					return false;
				});							
				if(existeRespuesta)// Si existe la respuesta, actualizarla
				{
					respuestasDB({'id_pregunta':id_pregunta,'id_categoria':id_categoria}).update({valor_respuesta:valor,id_item:id_item,id_categoria:id_categoria});
				}
				else // Sino existe la respuesta, agregarla		
				{
					respuestasDB.insert(new respuesta(id_respuesta,valor,id_item,id_pregunta,id_categoria));              
					id_respuesta++;
				}
				break;
			case 2: // TIPO CONJUNTIVA => Buscar si existe la misma: pregunta, categoria e item
				respuestasDB().filter({'id_pregunta':id_pregunta,'id_categoria':id_categoria,'id_item':id_item}).each(function () {
					existeRespuesta=true;
					return false;
				});						
				if(existeRespuesta)  // Si existe la respuesta, eliminarla
				{ 					
					respuestasDB({'id_pregunta':id_pregunta,'id_categoria':id_categoria,'id_item':id_item}).remove();
					id_respuesta--;
				}
				else // Sino existe la respuesta, agregarla
				{
					respuestasDB.insert(new respuesta(id_respuesta,valor,id_item,id_pregunta,id_categoria));              
					id_respuesta++;
				}				
				break;		
			case 3:
				respuestasDB().filter({'id_pregunta':id_pregunta,'id_categoria':id_categoria,'id_item':id_item}).each(function () {
					existeRespuesta=true;
					return false;
				});
				if(existeRespuesta)// Si existe la respuesta, actualizarla
				{
					respuestasDB({'id_pregunta':id_pregunta,'id_categoria':id_categoria,'id_item':id_item}).update({valor_respuesta:valor,id_item:id_item,id_categoria:id_categoria});
				}
				else // Sino existe la respuesta, agregarla		
				{
					respuestasDB.insert(new respuesta(id_respuesta,valor,id_item,id_pregunta,id_categoria));              
					id_respuesta++;
				}				
				break;
				
		}        				
        // respuestasDB().each(function (r1) {
           // console.log(r1); 
        // });
    }		

	function save_content_to_file(content, filename){		
		var dlg = false;
		with(document){
		 ir=createElement('iframe');
		 ir.id='ifr';
		 ir.location='about.blank';
		 ir.style.display='none';
		 body.appendChild(ir);
		
		  with(getElementById('ifr').contentWindow.document){
			   open("text/plain", "replace");
			   charset = "utf-8";
			   write(content);
			   close();
			   document.charset = "utf-8";
			   dlg = execCommand('SaveAs', true, filename);
		   }
		   //body.removeChild(ir);
		 }
		return dlg;
	}

	function cargar_contenidos(){
		
		respuestasDB().each(function(r1){												
			console.log(r1);
		});
		
		while(cursor<44)
		{		
			respuestasDB().filter({'id_pregunta':cursor.toString()}).each(function(r1){												
				console.log(r1);
			});
			cargar_contenido(cursor);
			cursor++;
		}
	}
	
	function enviar_cuestionario(){
	
	}
	
	function cargar_toma(){
	
	}
	
	function cargar_tomas(){
		
		var xmlhttp;
		
		if (window.XMLHttpRequest){// code for IE7+, Firefox, Chrome, Opera, Safari			
			xmlhttp=new XMLHttpRequest();
		}
		else{// code for IE6, IE5
			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
		}
		
		xmlhttp.onreadystatechange=function(){
			if (xmlhttp.readyState==4 && xmlhttp.status==200){
				
				var data = JSON.parse(xmlhttp.responseText);
				
				$(data).each(function(key,value){				
					switch(parseInt(value.estado))
					{
						case 2:
							var estado="<a class='revisar' id_toma='"+value.id+"' href='#'>REVISAR</a>";
							break;
						case 3:
							var estado="<label>REVISADA</a>";
							break;
					}
					// alert(estado);
					$('#tabla_tomas').dataTable().fnAddData([value.id,value.sala,value.auditor,value.fecha,estado]);
										
				});		
				
				$('.revisar').click(function(event){
					
					var id_toma=$(event.target).attr('id_toma');																				
					
					var xmlhttp;
		
					if (window.XMLHttpRequest){// code for IE7+, Firefox, Chrome, Opera, Safari						
						xmlhttp=new XMLHttpRequest();
					}
					else{// code for IE6, IE5
						xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
					}
					
					xmlhttp.onreadystatechange=function(){
					
						if (xmlhttp.readyState==4 && xmlhttp.status==200){												
							var data = JSON.parse(xmlhttp.responseText);	
							
							respuestasDB=TAFFY(data);
							
							var callbacks = $.Callbacks();					
							callbacks.add( cargar_contenidos() );							
							$('#tomas').hide();
							$('#container').show();
						}				
					}
					xmlhttp.open("GET","php/cargar_toma.php?id_toma="+id_toma,true);
					xmlhttp.send();	
				});				
			}
		}
		xmlhttp.open("GET","php/cargar_tomas.php",true);
		xmlhttp.send();		
	}
	
	function decorar_tablas(){
		$('.dataTable').dataTable({
		// "sScrollY": "520px",		 		 		
		"bFilter": false,
		"bSort": false,
		"bInfo": false,
		"bPaginate": false,
		"bJQueryUI": false,
		"bAutoWidth": false, 		
		"aoColumnDefs": [{ "aTargets": [0] }],		
		});		
		
		$('#tabla_tomas').dataTable({
		"sScrollY": "520px",		 		 		
		"bFilter": true,
		"bSort": false,
		"bInfo": false,
		"bPaginate": false,
		"bJQueryUI": true,
		"bAutoWidth": false, 				
		});				
	}
	
$(document).ready(function() {		

	$('button').button();
	$('button').css('padding','0em');
	$('span').css('padding','0em');		
	
	var callbacks = $.Callbacks();
	callbacks.add( cargar_datos() );
	callbacks.add( decorar_tablas() );
	callbacks.add( cargar_tomas() );
	
	// callbacks.add( decorar_tablas() );	
	// callbacks.add( cargar_contenidos() );		
	
	$('#guardar').click(function(){		
		save_content_to_file(respuestasDB().stringify(), pathCuestionario);
	});
	
	$('.cursor').click(function(){			
	
		if($(this).attr('id')==='ant')
		{
            if(cursor>1)							
                cursor--;
		}
		else
		{
            if(cursor<42)							
                cursor++;
		}							
		cargar_contenidos();						
	});	
});
</script>
</head>
<body>

<div id="container" style="width:100%;display:none;">

    <table id='cuestionario' width='100%' class='display table dataTable' border=1>
			<thead>
            <tr style="background-color:#000000">
				<th style='vertical-align:middle'>
						<h4 style="color:#FFFFFF;">
								CUESTIONARIO PSA
						</h4>
				</th>
            </tr>
			<thead>
			<tbody>
            <tr>
				<td style='vertical-align:middle'>
					<table id='topico1' class='display table dataTable' width='100%' border=1>
						<thead>	
							<tr>
								<th id='head_topico1'>
									Topico1
								</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<table id='seccion11' class='display table dataTable' width='100%' border=1> 
										<thead>
											<tr>
												<th>
													Seccion11
												</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</td>
							</tr>
							<tr>
								<td>
									<table id='seccion12' class='display table dataTable' width='100%' border=1>
										<thead>
											<tr>
												<th>
													Seccion12
												</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</td>
							</tr>	
							<tr>
								<td>
									<table id='seccion13' class='display table dataTable' width='100%' border=1>
										<thead>
											<tr>
												<th>
													Seccion13
												</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</td>
							</tr>
							<tr>
								<td>
									<table id='seccion14' class='display table dataTable' width='100%' border=1>
										<thead>
											<tr>
												<th>
													Seccion14
												</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</td>
							</tr>
							<tr>
								<td>
									<table id='seccion15' class='display table dataTable' width='100%' border=1>
										<thead>
											<tr>
												<th>
													Seccion15
												</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</td>
							</tr>							
						</tbody>
					</table>		
				</td>
            </tr>
            <tr>
				<td style='vertical-align:middle'>
					<table id='topico2' class='display table dataTable' width='100%' border=1>
						<thead>						
							<tr>
								<th id='head_topico2'>
									Topico2
								</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<table id='seccion26' class='display table dataTable' width='100%' border=1>
										<thead>
											<tr>
												<th>
													Seccion21
												</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</td>
							</tr>
							<tr>
								<td>
									<table id='seccion27' class='display table dataTable' width='100%' border=1>
										<thead>
											<tr>
												<th>
													Seccion22
												</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</td>
							</tr>	
							<tr>
								<td>
									<table id='seccion28' class='display table dataTable' width='100%' border=1>
										<thead>
											<tr>
												<th>
													Seccion23
												</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</td>
							</tr>								
						</tbody>
					</table>		
				</td>
            </tr>		
			<tr>
				<td style='vertical-align:middle'>
					<table id='topico3' class='display table dataTable' width='100%' border=1>
						<thead>						
							<tr>
								<th id='head_topico3'>
									Topico3
								</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<table id='seccion39' class='display table dataTable' width='100%' border=1>
										<thead>
											<tr>
												<th>
													Seccion31
												</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</td>
							</tr>
							<tr>
								<td>
									<table id='seccion310' class='display table dataTable' width='100%' border=1>
										<thead>
											<tr>
												<th>
													Seccion32
												</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</td>
							</tr>								
						</tbody>
					</table>		
				</td>
            </tr>		
			<tbody>
    </table>		
    <table width='70%' align='center'>    
        <tr>
            <td>
                <button class='cursor' id='ant' style='padding:0em;margin:0em'>
					<!-- Ant -->
                    <img src='images/arrow-left.png' style='width:2em;height:1em'/>
                </button>                
            </td>
            <td>
                <button id='guardar' style='width:100%;height:50%'>
					<!-- Guardar -->
                    <img src='images/System-Save-icon.png' style='width:2em;height:1em'/>
                </button>  
            </td>
            <td>
                <button id='enviar' style='width:100%;height:50%'>
					<!-- Enviar -->
                    <img src='images/600px-Black_check.svg.png' style='width:2em;height:1em'/>
                </button> 
            </td>
            <td>
                <button class='cursor' id='sig' style='padding:0em;margin:0em'>
					<!-- Sig -->
                    <img src='images/arrow.png' style='width:2em;height:1em'/>
                </button>	
            </td>
        </tr>
    </table>
</div>
<div id='tomas'>
<table id='tabla_tomas' width='100%'>
	<thead>
		<tr>
			<th width='20%'>
				TOMA
			</th>
			<th width='20%'>
				FOLIO SALA
			</th>
			<th width='20%'>
				AUDITOR
			</th>			
			<th width='20%'>
				FECHA
			</th>					
			<th width='20%'>
				ESTADO
			</th>
		</tr>
	</thead>
</table>
<a id='nueva_toma' href>
	NUEVA TOMA
</a>
</div>
</body>
</html>